<!doctype html>
<html lang=en-us>
<head><meta charset=utf-8>
    <title>Hangman!</title>
    <script src="./js/react-0.12.2.js"></script>
    <script src="./js/JSXTransformer-0.12.2.js"></script>
    <script src="./js/jquery-1.11.2.min.js"></script>
    <!-- uncomment in production
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/JSXTransformer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/react.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    -->
</head>
<body>
    <div id="content"></div>
    <script type="text/jsx">
    var data = {}

    //process data from json outside of rendering.

    var GameBox = React.createClass({
        getInitialState: function () {
            return {data}
        },

        handleGameSubmit: function(guess) {
            $.ajax({
                url: this.props.url,
                contentType: "application/json",
                datatype: 'json',
                type: 'PUT',
                data: JSON.stringify(guess),
                success: function(data) {
                    this.setState({data});
                }.bind(this),
                error: function(xhr, status, err) {
                    console.error(this.props.url, status, err.toString());
                }.bind(this)
            });
        },

        componentDidMount: function() {
            $.ajax({
                url: this.props.url,
                dataType: 'json',
                success: function(data) {
                    this.setState({data});
                }.bind(this),
                error: function(xhr, status, err) {
                    console.error(this.props.url, status, err.toString());
                }.bind(this)
            });
        },

        render: function() {
            return (
                <div className="gameBox">
                    <h2>Hangman!</h2>
                    <SessionStats data={this.state.data} />
                    <GallowsGraphic data={this.state.data} />
                    <WordFields data={this.state.data} />
                    <GameMessage data={this.state.data} />
                    <GameForm onGameSubmit={this.handleGameSubmit} />
                </div>
            );
        }
    });

    var GameForm = React.createClass({
        handleSubmit: function(e) {
            //gets field values
            e.preventDefault();
            var spot = this.refs.spot.getDOMNode().value.trim();
            var letter = this.refs.letter.getDOMNode().value.trim();
            if (!spot || !letter) {
                return;
            }
            this.props.onGameSubmit({spot: spot, letter: letter});
            //clear field values
            this.refs.spot.getDOMNode().value = '';
            this.refs.letter.getDOMNode().value = '';
            return;
        },
        render: function() {
            return(
                <form className="gameForm" onSubmit={this.handleSubmit}>
                    <h4>Guess</h4>
                    <label for="spot">Spot</label>
                    <input type="text" id="spot" ref="spot" />
                    <label for="letter">Letter</label>
                    <input type="text" id="letter" ref="letter" />
                    <input type="submit" value="Submit" />
                </form>
            );
        }
    });

    var GameMessage = React.createClass({
        render: function() {
            return(
                <div className="gameMessage">
                    <h3>Message</h3>
                    {this.props.data.message}
                </div>
            );
        }
    });


    var WordFields = React.createClass({
        render: function() {
            return(
                <div className="wordFields">
                    <h3>Word Field</h3>
                    the word is {this.props.data.current}
                </div>
            );
        }
    });

    var GallowsGraphic= React.createClass({
        render: function() {
            return(
                <div className="gallowGraphic">
                    <h3>The Gallows</h3>
                    the # of wrong guesses is {this.props.data.wrong}
                </div>
            );
        }
    });

    var SessionStats= React.createClass({
        render: function() {
            return(
                <div className="sessionStats">
                <h4>Session Stats</h4>
                    <p>SessionID = {this.props.data.sessionID}</p>
                    <p>wins = {this.props.data.sessionWins}</p>
                    <p>losses = {this.props.data.sessionLosses}</p>
                </div>
            );
        }
    });

    React.render(
        <GameBox url="http://localhost:5000/game_state" />,
        document.getElementById('content')
    );

    </script>
</body>
</html>
